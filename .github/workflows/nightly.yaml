name: sync-nightly-tag-to-latest

on:
  schedule:
    # 每天 UTC 时间 00:00 自动触发构建
    - cron: "0 0 * * *"
  workflow_dispatch:

jobs:
  create-nightly-release:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # 确保获取所有历史和标签

      - name: Configure Git
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"

      - name: Update 'nightly' tag
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # 删除本地和远程的 'nightly' 标签（如果存在）
          git tag -d nightly || true
          git push origin :refs/tags/nightly || true
          # 创建新的 'nightly' 标签并推送
          git tag nightly
          git push origin refs/tags/nightly
